# LOGFILE

## 0120

### UPDATE

1. `init.py`

   a) 先詢問有興趣的類股，類股代號從yahoo財金網抓取，函式名稱為`list_sectorID()`

   b) 接著選擇模式，有train和predict兩種，train mode和原版完全相同，predict mode尚未開工，詳見TODO 1

   c) 接著選擇新聞來源，只有ltn能指定日期區間，好處為不用從頭抓，且新聞比另外兩個來源多，但壞處是會被ban掉，詳見TODO 2

   d) 在抓新聞之前，要先得知上次新聞抓到哪一天，抓完後也要更新，故新增`setting.json`，但現在只有紀錄`last_update`，但應該要更齊全，詳見TODO 3

2. `utils.py`

   a) 新增`list_sectorID()`，讓使用者可以更直觀的選擇類股

   b) 新增`write_news(output_file, news_list)`，原本抓完新聞是直接創立新檔案，把舊檔案，也就是舊新聞覆蓋，目前改完append在最前面，也就是不會覆蓋舊新聞

3. `setting.json`

   目前只紀錄上次更新新聞的日期

### TODO

1. 目前想像的predict mode 是在更新完新聞後，只針對今天有新聞的股票，預測明天的漲或跌，輸出應該如下：

   ```
   股票代碼：0000.TW
   股票名稱：XX公司
   本日新聞標題：XX公司真賺錢
   本日新聞內文：XX公司棒
   預測明日股價漲跌：漲
   ```

   因為用關鍵字搜尋新聞可能會爬到莫名的東東，所以顯示標題和內文可以讓使用者判斷可信度

   另外，在預測前應該要讓使用者選擇要使用的model（多一個input）

2. 降低被ban的可能，目前只有改request header，應該有其他招數可用

3. 目前`setting.json`只有紀錄了上次更新的日期，但我們在抓新聞的時候，是針對不同類股在抓，可能A類股上次更新是12/20，B類股上次更新是1/15，如果我更新B就把上次更新的日期改成今天，那下次更新A就會少12/20到今天的新聞，所以last_updated應該要針對每個sectorID都要有一個dictionary，甚至每一個stock_code都要有一個。

   另外，如果爬到一半被ban掉，應該要有一個機制是下次抓的時候可以接續上次進度，而不是從頭抓，我的想法是在每個sectorID的dict中，新增`finished`, `stock_code`這兩個參數，分別代表是否完成，以及上次抓到哪隻股票，沒抓完就不要寫回去檔案了。

4. 前三個都是針對API如何設計，這點偏向要調整整個架構

   目前我們的input只有新聞標題＋內文，output只有漲或跌，我認為至少要把技術面的分析加進去，準確率才會提升，我目前的想法是使用LLM並設計prompt，例如：

   ```
   今天的收盤價為10元，
   (5MA = 20, 20MA = ...)
   (5日RSI = 70%, 20日RSI = ...)
   (sharpe ratio = ...)
   (前幾天的股價分別為...)
   今天的新聞標題為...
   內文為...
   請問明天的股價有可能漲或跌？
   ```

   這樣的不確定性在於LLM的數學好不好，畢竟很常有chatgpt亂算數學的狀況，不確定是openai故意讓他變笨，否則會浪費計算資源，還是LLM本來就是透過字詞之間的關係預測下一個字，而數字對其而言更像一個個不同的embedding vector，要做計算本來就不容易，但目前也只能先這樣了。且這樣設計prompt的好處在於當某支股票當天沒有新聞時，也可以透過基本的數據預測漲或跌。